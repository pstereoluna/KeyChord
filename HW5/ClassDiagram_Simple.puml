@startuml KeyChord Class Diagram

package "MODEL" {
    class PianoModel {
        +startRecording()
        +stopRecording()
        +playNote(int)
        +playChord(int)
        +startPlayback(Recording)
    }
    
    class Recorder {
        +startRecording()
        +recordNoteOn(int): NoteEvent
    }
    
    class Player {
        +startPlayback(EventSource, Handler)
        +stopPlayback()
    }
    
    class Recording {
        +getName(): String
        +addNoteEvent(NoteEvent)
        +getEvents(): List<NoteEvent>
    }
    
    class NoteEvent {
        +getMidiNote(): int
        +getTimestamp(): long
    }
    
    class RecordingManager {
        +startRecording(): Recording
        +getRecording(String): Recording
    }
    
    class ChordManager {
        +generateChord(int): List<Integer>
    }
    
    class MidiSoundManager {
        +{static} getInstance()
        +playNote(int)
    }
}

package "VIEW" {
    class MainWindow {
        +getPianoView(): PianoView
    }
    
    class PianoView {
        +getKeyboardPanel()
        +getControlPanel()
        +getRecordingPanel()
    }
    
    class PianoKeyboardPanel {
        +highlightKey(int)
    }
    
    class ControlPanelView
    class RecordingPanel
}

package "CONTROLLER" {
    class PianoController {
        +handleNotePressed(int)
    }
    
    class RecordingController
    class PlaybackController
    class RecordingPanelController
}

class KeyChordApp {
    +{static} main(String[])
}

' 只显示最重要的关系
PianoModel *-- Recorder
PianoModel *-- Player
PianoModel *-- ChordManager
PianoModel *-- RecordingManager
PianoModel --> MidiSoundManager
PianoModel ..> Recording

RecordingManager *-- Recording
Recording *-- NoteEvent
Recorder ..> NoteEvent

MainWindow *-- PianoView
PianoView *-- PianoKeyboardPanel
PianoView *-- ControlPanelView
PianoView *-- RecordingPanel

PianoController ..> PianoModel
PianoController ..> MainWindow
RecordingController ..> PianoModel
PlaybackController ..> PianoModel
RecordingPanelController ..> PianoModel

KeyChordApp ..> MainWindow
KeyChordApp ..> PianoModel

@enduml
